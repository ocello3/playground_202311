# きっかけ
GENUARYのPerfect loop / Infinite loop / endless GIFsから始めた。Loopと聞くとカセットテープを模したop-1のテープレコーダーをが頭に浮かんで、4トラックのカセットプレーヤーを並べて、4つの会話フレーズを交互に再生するスケッチにした。

# 考え中
- 再生と再生の間の空白の間隔を制御する。
- 再生を開始するタイミングの管理: 1つのトラックの再生が終わったら、そのトラックを小さく逆再生し、次のトラックを選び再生開始する。逆再生が終わると待機する。
- 背景音としてノイズを薄く再生する。

# おわり
- mp3が再生できることを確認する。
- テープの外枠を4つ左上から右下に向かって並べる。
- リールの外枠を描画する。
- レイヤーごとにp5.Graphicsを生成して、フレームごとにimage() → clear()する。
- 歯車書く。始点と終点、本数、長さ、間隔角度に回転角度。
- 歯車回す（回転した角度と前フレームの座標から計算できる？）
- debugのbugをdebug
- テープの支点を書く
- テープ書く
- 巻かれたテープを書く
- reel.contactの位置に巻かれたテープの厚みを反映する
- 再生をコントロールする仕組みを考える。
- paramではflagのみ管理する。callbackでもdtを操作できそう。
- iPadだとpGraphicsを複数描画するとかなり重くなるので、レイヤーを1枚にまとめる
- 再生のコントロールの再生向きをrateで判別しているが別の方法に変えて、rateの符号をなくす。
- draw及びsoundの再生を別ファイルにする
- reelの回転速度をrateにして、向きをplay/reverseから決定する。
- player.ctrl.statusの計算が間違っている気がする。最後のelse ifで前フレームのstatusはkeepなので判別できていなさそう。nxtが配列になっていて、どのindexが再生されているか分からない。条件分岐をシンプルにして解決した。
- リールのテープの厚みをspeedに紐づける。rateの条件が計算できる？音源の長さに依存する。音源を通常再生で再生した場合の秒数からフレーム数を計算して、それが上限の厚みとなる。→ ctrlにlengthを追加する。→テープの厚みが増えない。→　左のリールと右のリールで増減を逆にする。
- tapeIncをフレーム数から計算してるけどp5soundのcurrentTimeからprogressを計算して用いる。
- alphaを再生が進むに連れて小さくする。線をできるだけなくす。reelの歯車をどうする？→reelの中と外でalpha値を反転させる。歯車は濃いめのalpha値で固定する。

# 待ち
- 線の配色を目立たせる。塗りつぶしの色について、グラデーションで2点を決めてその間でleapする。directionの依存を外す。歯車の線の色はouterと同じ。外枠の色は濃い色で固定。reelの内側とテープ部分で色を変える。背景はかなり薄く。
- 再生中のトラックのレイヤーを前にする。レイヤーの優先順位を配列で管理する。
- 再生時にmp3が再生されてしまう問題を解決する。
- 4トラックに分ける。
- パンをふる
- endedでseをつける
- 音量の調節（全部0は大きすぎる）
- nxtで次のトラックを選ぶ時に再生が終了したばかりのトラックも選ばれるので、除外したい。
- 再生時の音量を取得してテープに波形を表示する
- テープを見ても再生方向が分かりにくい。波形表示の向きで区別する

# 再生の管理
play, reverse, stopの3つの状態を遷移する。
初期値はすべてstopとする。 -> どれかをplay
onendedとして、play -> reverse、reversr -> stopを設定する。

決めること
- stopからstartへのトリガーをどうするか
- 1フレーム目では再生開始したくない -> isInitでなければ最初のトラックをplayに更新

前フレームと同じ -> 何もしない
前フレームと違う -> 変更後の状態を実行する